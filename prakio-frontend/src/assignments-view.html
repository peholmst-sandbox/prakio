<!--
@license
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="assignment-card.html">

<dom-module id="assignments-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      paper-progress {
        --paper-progress-active-color: var(--dark-primary-color);
        width: 100%;
      }

      #cards {
        display: flex;
        flex-wrap: wrap;
      }

      .pending {
        background-color: var(--google-red-100);
      }

      .done {
        background-color: var(--google-green-100);
      }
    </style>
    <!-- TODO toolbar -->

    <div slot="toolbar">
      <div main-title>Assignments</div>
    </div>

    <!-- TODO Pagination -->
    <iron-ajax
        auto
        url="[[apiEndpoint]]/api/1.0/assignments/brief"
        handle-as="json"
        last-response="{{assignments}}"
        last-error="{{loadingAssignmentsError}}"
        loading="{{loadingAssignments}}"></iron-ajax>

    <template is="dom-if" if="[[loadingAssignments]]">
      <paper-progress value="10" indeterminate></paper-progress>        
    </template>
    
    <template is="dom-if" if="[[loadingAssignmentsError]]">
      <div class="error">
        There was an error retrieving assignments. Please try again.
      </div>
    </template>

    <div id="cards">
      <template is="dom-repeat" items="[[assignments]]">
        <assignment-card 
            code="[[item.code]]"
            description="[[item.description]]"
            location="[[item.location.municipality]], [[item.location.address]]"
            timestamp="[[item.timestamp]]"
            class$="[[item.state]]">
        </assignment-card>
      </template>
      <!-- TODO Show text if there are no assignments -->
    </div>

    <paper-fab icon="add"></paper-fab>
  </template>

  <script>
    class AssignmentsView extends Polymer.Element {
      static get is() { return 'assignments-view'; }

      static get properties() {
        return {
          title: {
            type: String,
            value: 'Assignments',
            readOnly: true,
            notify: true
          },
          apiEndpoint: {
            type: String,
            value: AppConfiguration.apiEndpoint
          }
        };
      }
    }

    window.customElements.define(AssignmentsView.is, AssignmentsView);
  </script>
</dom-module>
